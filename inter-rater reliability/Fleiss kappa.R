library(irr)

coders <- as.matrix(read.table(text = "
5 0	0	0	2	0	0	0	0	0	0
2	4	3	3	4	4	4	4	5	4	2
2	1	3	2	5	0	3	0	3	0	5
0	5	2	2	0	0	0	2	5	1	1
0	0	0	5	0	0	0	0	1	0	4
4	0	1	1	5	0	0	0	0	0	1
3	2	2	2	5	2	1	2	2	3	5
0	0	5	0	0	0	1	0	3	0	0
2	1	0	0	1	1	0	4	4	4	0
1	4	1	0	0	2	1	4	1	4	0
0	0	0	0	2	0	0	1	3	0	2
1	1	0	0	4	0	0	3	4	1	3
0	0	2	1	5	1	1	0	0	0	1
4	0	0	0	5	1	1	0	1	0	1
0	0	0	0	5	0	0	0	0	0	2
0	5	1	2	0	0	0	1	3	0	0
0	5	1	0	0	0	0	2	3	0	1
0	0	0	0	0	1	1	5	0	3	0
0	4	0	0	0	0	3	5	3	3	0
0	1	0	0	1	0	2	5	3	3	0
0	0	0	0	0	5	1	3	1	0	0
0	0	0	0	0	0	4	5	1	0	0
2	1	0	0	3	1	1	3	5	0	2
1	1	1	1	5	0	0	0	0	0	3
0	0	1	0	4	0	1	0	3	0	2
0	0	5	0	0	0	0	0	0	0	0
1	0	0	0	4	0	1	0	5	0	5
5	0	0	0	3	0	0	0	0	2	1
0	5	0	0	0	0	0	0	2	0	0
0	0	0	0	0	5	1	2	0	0	0
2	0	3	0	0	1	4	1	1	3	0
0	0	0	0	4	0	0	0	1	0	3
1	0	0	0	4	0	0	0	2	0	3
0	0	0	0	4	0	0	0	0	0	2
0	0	0	0	4	0	0	0	2	0	1
1	3	2	0	1	3	1	4	4	2	0
4	2	2	3	5	1	0	0	2	0	3
5	0	0	0	5	0	0	0	0	0	0
0	1	0	0	0	1	2	4	0	4	0
0	5	0	0	0	0	0	0	0	0	0
3	0	1	1	1	0	0	0	3	0	1
3	0	1	2	0	0	0	0	4	0	1
1	5	0	0	0	0	0	0	1	0	0
0	1	1	0	1	2	1	2	1	1	0
1	1	3	0	0	2	4	4	0	4	0
4	2	3	2	2	2	2	3	4	3	4
0	0	0	0	5	0	0	0	0	0	2
0	0	0	0	4	0	0	0	0	1	1
1	3	0	0	4	0	0	0	0	0	0
0	0	0	0	4	0	0	0	0	0	1
5	0	0	0	1	0	0	1	0	0	0
0	0	2	0	0	2	4	5	0	3	0
3	0	0	2	1	0	0	0	1	0	4
0	0	0	0	2	0	0	2	3	0	0
0	0	0	0	1	0	0	2	1	0	0
0	5	0	0	0	0	0	0	2	0	0
0	5	0	0	0	0	0	0	1	0	0
0	0	0	5	1	0	0	0	1	0	3
0	0	0	5	1	0	0	0	1	0	3
5	0	0	1	0	1	0	0	3	0	0
5	0	0	0	1	0	0	0	0	0	0
5	0	0	0	2	0	0	0	0	0	1
5	0	0	0	1	0	0	0	1	0	1
5	0	0	0	0	1	0	0	0	3	2
4	0	0	0	1	0	0	0	0	1	0
5	0	0	0	1	0	0	0	0	0	0
0	0	0	0	4	0	0	0	3	0	1
0	0	0	0	4	0	0	0	0	0	2
0	0	0	0	3	0	0	0	0	0	3
1	0	0	0	4	0	0	0	0	0	4
3	0	0	0	4	0	0	0	0	0	2
0	0	0	0	3	0	0	1	2	0	1
0	0	0	0	4	0	0	0	1	0	3
0	0	0	5	0	0	0	0	0	0	4
2	0	0	4	0	0	0	0	0	0	2
0	0	1	0	0	0	5	4	1	4	0
1	2	0	0	0	2	0	5	1	2	0
1	0	1	0	0	0	5	4	2	1	0
0	1	0	0	1	0	1	5	3	0	0
2	0	0	0	0	0	0	5	0	5	0
0	0	0	0	0	0	0	5	0	1	0
1	0	0	0	0	5	0	2	0	0	0
1	0	0	0	0	5	0	5	3	0	0
0	0	0	0	0	0	0	0	0	5	0
1	0	0	0	2	5	0	5	0	0	0
4	2	2	2	4	1	1	1	2	1	3
5	0	0	0	4	1	0	0	0	0	1
4	0	0	0	3	1	0	0	0	0	1
2	0	0	0	3	1	0	1	4	0	0
4	0	0	0	5	0	0	0	0	0	3
2	0	0	0	5	0	0	0	0	0	1
3	1	1	1	5	0	0	0	0	0	1
0	0	5	0	0	0	0	0	0	0	0
0	0	5	0	0	0	0	0	0	0	0
0	0	5	0	0	0	0	0	0	0	0
0	0	5	0	0	0	0	0	0	0	0
0	0	5	0	0	0	0	0	0	0	0
2	0	0	0	0	2	0	0	4	0	2
2	0	0	0	0	1	0	0	5	0	2
5	0	0	2	0	0	0	0	1	1	4
4	0	0	0	2	0	0	0	1	0	5
1	0	0	1	4	0	0	0	2	1	5
1	0	0	0	4	0	0	0	2	0	5
0	5	0	0	0	0	0	0	0	0	0
0	5	0	0	0	0	0	0	2	0	0"))

fleisskappa <- function (matrix, raters = NA){
  nr <- nrow(matrix)
  nc <- ncol(matrix)
  method <- "Fleiss' Kappa for m raters"

  pj <- apply(matrix, 2, sum)/(nr * raters)
  pi <- (apply(matrix^2, 1, sum) - raters) / (raters * (raters -1))
  
  agreeP <- mean(pi)
  chanceP <- mean(pj)   
  kappa <- (agreeP - chanceP)/(1 - chanceP)

  rval <- list(method = method, kappa = kappa, subjects = nr, categories = nc, raters = raters)
  return(rval)
}

# Standardise rows to mean 5
coders.std<- coders * 5 / apply(coders, 1, sum)

# This probably is very wrong
fleisskappa(coders.std, 5)

